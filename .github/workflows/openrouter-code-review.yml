name: OpenRouter Code Review

permissions:
  contents: read
  pull-requests: write

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  code-review:
    if: ${{ contains(github.event.pull_request.title, ":review") }}
    runs-on: ubuntu-latest
    steps:
      - name: Display PR title
        run: echo "PullRequest: ${{ github.event.pull_request.title }}"
      - name: Run ChatGPT Code Review (OpenRouter GLM)
        uses: anc95/ChatGPT-CodeReview@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          OPENAI_API_ENDPOINT: https://openrouter.ai/api/v1
          MODEL: 01-ai/glm-4-7b
          LANGUAGE: English
          PROMPT: |
            You are an experienced reviewer for TypeScript and Node.js projects.
            Read the diff and briefly list any critical bugs or security concerns.
            If the changes are only minor, respond with "No critical issues found."
